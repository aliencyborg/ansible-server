---
- name: pretty-good docker network
  docker_network:
    name: pretty-good

- name: pretty-good backups container
  docker_container:
    image: mariadb:10.3
    name: pretty-good-db-backups
    state: present
    volumes:
      - /backups

- name: pretty-good content container
  docker_container:
    name: pretty-good-content
    image: ghost:1.8.7
    pull: yes
    state: present

- name: pretty-good data container
  docker_container:
    image: mariadb:10.3
    name: pretty-good-db-data
    state: present
    volumes:
      - /var/lib/mysql

- name: pretty-good db
  docker_container:
    env_file: pretty-good.env
    image: mariadb:10.3
    name: pretty-good-db
    state: started
    networks:
      - name: pretty-good
    volumes_from:
      - pretty-good-db-backups
      - pretty-good-db-data

- name: pretty-good web
  docker_container:
    env_file: pretty-good.env
    image: ghost:1.8.7
    name: pretty-good-web
    restart: yes
    state: started
    env:
      VIRTUAL_HOST: "prettygoodprogress.org,www.prettygoodprogress.org"
      LETSENCRYPT_HOST: "prettygoodprogress.org,www.prettygoodprogress.org"
      LETSENCRYPT_EMAIL: "thealiencyborg@gmail.com"
    exposed:
      - 2368
    networks:
      - name: pretty-good
        links:
          - "pretty-good-db:mysql"
        volumes_from:
          - "pretty-good-content"
