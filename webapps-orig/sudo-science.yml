---
- name: sudo-science backups container
  docker_container:
    image: mariadb:10.3
    name: sudo-science-db-backups
    state: present
    volumes:
      - /backups

- name: sudo-science content container
  docker_container:
    name: sudo-science-content
    image: aliencyborg/sudo-science-content:latest
    pull: yes
    state: present

- name: sudo-science data container
  docker_container:
    image: mariadb:10.3
    name: sudo-science-db-data
    state: present
    volumes:
      - /var/lib/mysql

- name: sudo-science db
  docker_container:
    env_file: sudo-science.env
    image: mariadb:10.3
    name: sudo-science-db
    state: started
    published_ports:
      - "43306:3306"
    volumes_from:
      - sudo-science-db-backups
      - sudo-science-db-data

- name: sudo-science adminer
  docker_container:
    image: adminer:latest
    name: sudo-science-adminer
    state: started
    links:
      - "sudo-science-db:db"
    published_ports:
      - "43308:8080"

- name: sudo-science web
  docker_container:
    env_file: sudo-science.env
    expose: 2368
    image: ghost:1.22
    name: sudo-science-web
    restart: yes
    state: started
    env:
      VIRTUAL_HOST: "sudo-science.com,www.sudo-science.com"
      LETSENCRYPT_HOST: "sudo-science.com,www.sudo-science.com"
      LETSENCRYPT_EMAIL: "ben@aliencyb.org"
    links:
      - "sudo-science-db:mysql"
    volumes_from:
      - sudo-science-content
